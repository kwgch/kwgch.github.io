<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Rails | 30才からのプログラマ]]></title>
  <link href="http://kwgch.github.io/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://kwgch.github.io/"/>
  <updated>2014-11-17T07:16:49+09:00</updated>
  <id>http://kwgch.github.io/</id>
  <author>
    <name><![CDATA[m.kwgch]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Nitrous.IOにTシャツもらいました]]></title>
    <link href="http://kwgch.github.io/blog/2014/10/15/hobby/"/>
    <updated>2014-10-15T00:26:43+09:00</updated>
    <id>http://kwgch.github.io/blog/2014/10/15/hobby</id>
    <content type="html"><![CDATA[<p>いつも利用している<a href="https://www.nitrous.io">Nitrous.IO</a>さんから、Tシャツとステッカーをいただきました！</p>

<p><img src="https://d3o0mnbgv6k92a.cloudfront.net/assets/hack-l-v1-4b6757c3247e3c50314390ece34cdb11.png" alt="HACK" /></p>

<!-- more -->


<h1>経緯</h1>

<p>こんなツイートを見かけたので</p>

<p><a href="https://twitter.com/NitrousIO/status/474708467224027136">https://twitter.com/NitrousIO/status/474708467224027136</a>">https://twitter.com/NitrousIO/status/474708467224027136">https://twitter.com/NitrousIO/status/474708467224027136</a></a></p>

<p>話かけてみた</p>

<p><a href="https://twitter.com/ducky19999/status/511687625153863680">https://twitter.com/ducky19999/status/511687625153863680</a>">https://twitter.com/ducky19999/status/511687625153863680">https://twitter.com/ducky19999/status/511687625153863680</a></a></p>

<p><a href="https://twitter.com/NitrousIO/status/511937047351660544">https://twitter.com/NitrousIO/status/511937047351660544</a>">https://twitter.com/NitrousIO/status/511937047351660544">https://twitter.com/NitrousIO/status/511937047351660544</a></a></p>

<p>この後、メールで住所等をやりとり</p>

<h1>届いた</h1>

<p>こんなんに入っていた</p>

<p><img src="/images/nitrous.io_pack.jpg" alt="nitrous.io pack" /></p>

<p>Tシャツ1枚とステッカー5枚入ってました！</p>

<p><img src="/images/nitrous.io_t_shits.jpg" alt="nitrous.io t-shits" /></p>

<p>ありがとうございました！</p>

<p><a href="https://twitter.com/ducky19999/status/522149761797738497">https://twitter.com/ducky19999/status/522149761797738497</a>">https://twitter.com/ducky19999/status/522149761797738497">https://twitter.com/ducky19999/status/522149761797738497</a></a></p>

<h1>Nitrous.IOって何？</h1>

<p>クラウドIDEってやつです。</p>

<p>参考：<a href="http://qiita.com/machu/items/0ecc5699273c18fd1cd8">WebブラウザだけではじめるRuby/Railsプログラミング</a></p>

<h1>使いはじめたきっかけ</h1>

<h3>イベント</h3>

<p> 2014-05-18に、すくすくスクラム広島のイベント<a href="http://sukusuku-scrum-hiroshima.doorkeeper.jp/events/10366">第5回「スクラムやってみる」</a>に参加し、1日スクラム開発体験をしました。</p>

<p>RubyチームとJavaチームに分かれて開発をしました。</p>

<h3>Javaから</h3>

<p>ぼくはjava使いなので、javaチームでした。</p>

<p>開発環境を揃える手間を省く為に、クラウドIDEである<a href="https://codenvy.com/">Codenvy</a>を使ってみたのですが、修正 -> 動作確認に時間がかかって、なかなかツラいものがありました…</p>

<p>ちなみに1日かけて作ったのが<a href="http://mkwgch.appspot.com/blog/">こちら。</a></p>

<h3>Rubyへ</h3>

<p>ところがRubyチームはNitrous.IOとやらで、Railsを使ってさくさく開発しているではありませんか！</p>

<p>ショックを受けた私は後日、気がつくと<a href="http://railstutorial.jp/">Ruby on Rails チュートリアル</a>のページを開いていました…</p>

<h3>Cloud9</h3>

<p>昼休みとかにチュートリアル進めたいなーと思ったのですが、派遣先のPCには勝手にRubyをインストールできません。</p>

<p>そうだ、クラウドIDEがあるじゃないか！</p>

<p>でも、ただRubyチームの真似するのも癪なので、<a href="https://c9.io">Cloud9</a>を使っていました。</p>

<h3>そしてNitrous.io</h3>

<p>でも何故か、だんだん動きが重くなってきたので、これはあかんと思い、<a href="https://www.nitrous.io">Nitrous.io</a>を使ってみました…</p>

<p>…さくさく動くじゃないか！</p>

<p>チュートリアルはNitrous.ioで終わらせました。</p>

<h3>余談</h3>

<p><a href="https://codeanywhere.com">Codeanywhere</a>も使ってみましたが、個人的にはNitrous.ioのほうが使いやすかったです。</p>

<p>paid userになってBOXが落ちないようにしてるので、tmux attachすれば、会社でも自宅でもネカフェでも即開発の続きができるようにしています。</p>

<p><a href="http://twitter-tools.herokuapp.com">例のアレ</a>もNitrous.ioでつくって、<a href="https://bitbucket.org/">Bitbucket</a>でソース管理して、<a href="https://www.heroku.com/">heroku</a>で動かして、<a href="http://newrelic.com/">Newrelic</a>で監視しています。ブラウザの中で完結します。</p>

<p>（NewrelicはなぜTシャツをくれないのだろう…）</p>

<h1>気になった人は</h1>

<p><a href="https://www.nitrous.io/join/3fMgAzQW0io?utm_source=nitrous.io&amp;utm_medium=copypaste&amp;utm_campaign=referral">ぜひこのリンクから始めてみてください。</a></p>

<p>ぼくにN2O<code>(※1)</code>が入るしくみです。</p>

<p><code>※1 Nitrous.IOでメモリやストレージが増やせるポイント</code></p>

<h1>Special Thanks</h1>

<p><a href="https://translate.google.com/?hl=ja#ja/en/%E7%A7%81%E3%81%AF%E6%97%A5%E6%9C%AC%E3%81%AB%E4%BD%8F%E3%82%93%E3%81%A7%E3%81%84%E3%82%8B%E6%9C%89%E5%84%9F%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A7%E3%81%99%E3%80%82%E7%A7%81%E3%81%AF%E3%82%B9%E3%83%86%E3%83%83%E3%82%AB%E3%83%BC%E3%82%92%E3%82%82%E3%82%89%E3%81%86%E3%81%93%E3%81%A8%E3%81%AF%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F">google翻訳</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SonicGardenコードレビュー勉強会#2 に参加しました]]></title>
    <link href="http://kwgch.github.io/blog/2014/10/08/sg-learning/"/>
    <updated>2014-10-08T12:03:37+09:00</updated>
    <id>http://kwgch.github.io/blog/2014/10/08/sg-learning</id>
    <content type="html"><![CDATA[<p>広島からリモートで、SonicGardenコードレビュー勉強会#2 に参加しました。</p>

<p><img src="http://www.sonicgarden.jp/assets/logo-535075f3e242d36af1a349451b6bdabf.png" alt="sonic_garden" /></p>

<!-- more -->


<h1>何をしたか</h1>

<p><a href="http://www.sonicgarden.jp/">SonicGarden</a>さんの主催する、コードレビュー勉強会に参加しました。</p>

<p>Ruby on Railsのソースコードレビューになります。</p>

<p>今回で２回目です。10名の参加でした。</p>

<h1>なぜ参加したのか</h1>

<p>実は、私はSonicGardenさんの<a href="http://www.sonicgarden.jp/guild">ソニックガーデンギルド</a>に挑戦中なのです。</p>

<p>その一環としてコードレビューを受けるのですが、ほかの人のコードレビューにも参加して、学習を加速させるというわけです。</p>

<h1>どうやったのか</h1>

<p><a href="http://www.google.com/intl/ja/+/learnmore/hangouts/onair.html">Google Hangouts on Air</a>というサービスを利用して参加しました。</p>

<p>これは、ライブ配信を行いながらビデオ通話やチャットができ、配信を終了するとYoutubeに動画として登録される、というものです。すごい！</p>

<p>レビューアはCTOの松村さんです。</p>

<h1>困ったこと</h1>

<p>はじめのうち、音声がハウリングしてしまい、よく聞き取れなくなりました。</p>

<p>レビューアとレビューイ以外がマイクをOFFにするといい具合になったので、チャット等で質問を投げる形式ですすめました。</p>

<h1>感想</h1>

<p>コードレビューをリアルタイムで視聴して、その場で質問できるというのは、すごくよい勉強になると思いました。</p>

<p>今回は見ながら考えてばかりで、質問投げれなかったのですが…</p>

<h1>学んだこと</h1>

<p>今回も含め、過去のレビュー動画を見て学んだことを、列挙してみます。</p>

<h3>全般</h3>

<ul>
<li>極力コードが短くなるようにする</li>
<li>ひとつのメソッドにひとつの仕事を書く</li>
<li>セッションに大きなデータ入れない</li>
<li>Ruby1.9以降のhashシンタックスを使ってコードを短く書く</li>
</ul>


<h3>controller</h3>

<ul>
<li>ロジックはconrollerではなくmodelに書く</li>
<li>scaffoldくらいの量のcontrollerで機能を実現できるのが理想</li>
<li>表示に関する処理は、controllerではなくviewやhelperに書く</li>
<li>共通した処理はbefore_actionなどのフィルターにまとめる</li>
<li>find!メソッドでデータ取れなければ、例外で404ページに飛ばせる</li>
</ul>


<h3>model</h3>

<ul>
<li>正しいリレーションにする （belongs_toを書く）</li>
<li>scopeでModelに検索条件を定義できる</li>
<li><a href="https://github.com/satour/rails-style-guide/blob/master/README-jaJA.md#sexy-validations">&ldquo;sexy&rdquo; validations</a> を利用する</li>
<li>ActiveRecordのメソッドチェインを使って流れるように書く</li>
<li>after_saveなど、ActiveRecordのコールバックを効果的に使う</li>
<li>アソシエーションしたモデルは、直接操作しない</li>
<li>親オブジェクトからメソッドチェイン的にbuildを呼び出すと、引数忘れがない</li>
<li>find_or_create_by便利</li>
<li>1対多のモデルで<a href="http://blog.livedoor.jp/sasata299/archives/51931176.html">accepts_nested_attributes_for</a>を使うとコードがすっきりする</li>
<li>has_manyなモデルはviewで<a href="http://railsdoc.com/references/fields_for">fields_for</a>を使う</li>
<li><a href="https://github.com/FooBarWidget/default_value_for">default_value_for</a>を使うと、modelにデフォルト値が簡単に書ける</li>
</ul>


<h3>view</h3>

<ul>
<li>helperを使ってDRYにする</li>
<li>erbで文字列に変数を連結するときは、+でつなげるより、#{ 変数 } を使う</li>
<li><a href="https://github.com/plataformatec/simple_form">simple_form</a>を使うと、シンプルなフォームなら早く作れる（デザインが凝った画面は大変かも）</li>
<li>パンくずリストは<a href="https://github.com/lassebunk/gretel">gretel</a>を使うとよい</li>
<li>hamlでインデントつけてもHTML通りにならない。<a href="http://railsdoc.com/references/content_tag_for">content_tag_for</a>を使う(これは好み)</li>
</ul>


<h3>routes</h3>

<ul>
<li>routesのresourcesブロックでmember（単票系）やcollection（一覧系）が使える</li>
<li>リソースを入れ子にして、親を only:[ ] だけにすると、子供のURLのみ生成</li>
<li>モデルのカーディナリティを意識したURL設計をする</li>
</ul>


<h3>そのほか</h3>

<ul>
<li>githubでURLをcompare/&lt;ハッシュ>&hellip;masterと打てばコンペアできる</li>
<li><a href="https://github.com/plataformatec/devise">devise</a>と<a href="https://github.com/intridea/omniauth">omniauth</a>で、Twitterとgithubアカウントでのログインを可能に</li>
<li><a href="https://github.com/charliesome/better_errors">better_errors</a>、<a href="https://github.com/banister/binding_of_caller">binding_of_caller</a>を入れて、エラー画面でreplできる</li>
<li><a href="https://github.com/intridea/hashie">hashie</a>を使って、ハッシュにドットでアクセスできる</li>
<li><a href="https://github.com/brainspec/enumerize">enumerize</a>を使うと列挙が扱える</li>
</ul>


<h1>まとめ</h1>

<p>とても勉強になります！また参加したいです。</p>

<p>ちなみにSonicGardenさんでは<a href="http://www.sonicgarden.jp/guild">ギルド参加者を募集しています</a>。</p>

<p><a href="http://www.sonicgarden.jp/category/concept/">納品のない受託開発</a>に興味のあるエンジニアは、申し込んでみるとよいのではないでしょうか。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[【rails】Githubアカウントでのログインを実装する]]></title>
    <link href="http://kwgch.github.io/blog/2014/09/03/rails/"/>
    <updated>2014-09-03T23:47:27+09:00</updated>
    <id>http://kwgch.github.io/blog/2014/09/03/rails</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/great-h/great-h.github.io/issues/1190">omniauthを使ってGitHubでログインする機能を実装する</a>と宣言したのですが、omniauthは<a href="https://github.com/plataformatec/devise">devise</a>に入ってました。</p>

<p>なのでdeviseを使いました。</p>

<p><img src="https://camo.githubusercontent.com/b1c21cc10f2f94857dea5135fe55f2e4d451e028/68747470733a2f2f7261772e6769746875622e636f6d2f706c617461666f726d617465632f6465766973652f6d61737465722f6465766973652e706e67" alt="devise" /></p>

<!-- more -->


<h1>準備</h1>

<p>まずアプリ作成（てきとう）
<code>bash
$ rails new github_login_sample
$ cd github_login_sample
$ rails g scaffold Blog title body:text
</code></p>

<p>Gemfileに下記を追加</p>

<pre><code class="ruby">gem 'devise'
gem 'omniauth-github'
gem "figaro"
</code></pre>

<p>deviseのinstall等</p>

<pre><code class="bash">$ bundle
$ rails g devise:install
$ rails g devise User
$ rails g migration AddColumnsToUsers provider uid
$ rake db:migrate
$ rails g figaro:install
</code></pre>

<h1>figaro</h1>

<p>figaroをインストールすると <code>config/application.yml</code> が作成され、<code>.gitignore</code> に下記が追加されます</p>

<pre><code>/config/application.yml
</code></pre>

<p><code>application.yml</code> には下記のように<code>APP_ID</code>と<code>APP_SECRET</code>を書きます。</p>

<pre><code>APP_ID: xxxxxxxxxxxxxxxxxxxx
APP_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>

<p>あ、これはGithubの Settings/Apprications/Register new application でアプリを登録すると発行されます。</p>

<p>そして <code>config/initializers/devise.rb</code> へ</p>

<pre><code class="ruby">  config.omniauth :github, ENV["APP_ID"], ENV["APP_SECRET"], scope: 'user,public_repo'
</code></pre>

<p>と書くわけです。<code>application.yml</code> に書いた名称と同じなら、<code>APP_ID</code>とかじゃなくても、何でもいいです。</p>

<p><code>application.yml</code> がgit管理対象外になっているので、githubに上げても<code>APP_ID</code>と<code>APP_SECRET</code>が知られなくていいですね。（privateリポジトリなら関係ないけど）</p>

<h1>routes</h1>

<p>次は<code>config/routes.rb</code> へ下記を追加。callbackのルーティングです。</p>

<pre><code class="ruby">  root 'blogs#index'
  get 'blogs/index'
  devise_for :users, :controllers =&gt; { :omniauth_callbacks =&gt; "users/omniauth_callbacks" }
  devise_scope :user do
    get 'sign_out', :to =&gt; 'devise/sessions#destroy', :as =&gt; :destroy_user_session
  end
</code></pre>

<h1>controller</h1>

<p>それから <code>app/controller/users/</code> に <code>omniauth_callbacks_controller.rb</code> を追加します。
callback時のログイン処理です。</p>

<pre><code>class Users::OmniauthCallbacksController &lt; Devise::OmniauthCallbacksController
  def github
    @user = User.find_or_create_by(user_params)

    if @user.persisted?
      sign_in_and_redirect @user, :event =&gt; :authentication
      set_flash_message(:notice, :success, :kind =&gt; "Github") if is_navigational_format?
    else
      session["devise.github_data"] = request.env["omniauth.auth"]
      redirect_to new_user_registration_url
    end
  end

  private
  def user_params
    request.env["omniauth.auth"].slice(:provider, :uid).to_h
  end
end
</code></pre>

<h1>model</h1>

<p><code>app/models/user.rb</code> に下記を追加。もうちょっとです。</p>

<pre><code class="ruby">class User &lt; ActiveRecord::Base
  devise :omniauthable
end
</code></pre>

<h1>view</h1>

<p>viewにSign in、Sign outを追加します。</p>

<pre><code class="erb">&lt;% if user_signed_in? %&gt;
    &lt;%= link_to "Sign out", destroy_user_session_path %&gt;
&lt;% else %&gt;
    &lt;%= link_to "Sign in with Github", user_omniauth_authorize_path(:github) %&gt;
&lt;% end %&gt;
</code></pre>

<h1>そして</h1>

<p>あとはログイン後に表示する箇所を</p>

<pre><code class="erb">&lt;% if user_signed_in? %&gt;

&lt;% end %&gt;
</code></pre>

<p>でくくるとか、controllerで認証処理を書けばいいわけです。</p>

<hr />

<h1>参考</h1>

<p>参考にさせていただきました。
<a href="http://qiita.com/soramugi/items/5b2ed46e8c8b6157e7cc">devise gemを使ってtwitter認証の設定</a></p>
]]></content>
  </entry>
  
</feed>
